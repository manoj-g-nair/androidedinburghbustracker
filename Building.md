# Introduction #

**These instructions do not apply to trunk. Please only use these instructions for the 2.1 tag. New instructions will be written in due course.**

Compiling and running My Bus Edinburgh is not as straight-forward as one might think. A few steps need to be undertaken before this is possible.

# Tools and prerequisites #

_This section will describe what tools are required to compile My Bus Edinburgh, but will not describe how to install them. You must consult the relevant websites for instructions. Also, usage will not be described except specifically for My Bus Edinburgh_

To compile My Bus Edinburgh, the latest Android SDK tools are required. At the time of writing, this is [version 19](http://developer.android.com/sdk/tools-notes.html).

The [Android 4.0 SDK](http://developer.android.com/sdk/android-4.0-highlights.html) must be installed, with the Google APIs extension also installed. This is because My Bus Edinburgh targets Android 4.0 (API level 14) for compiling, and also makes use of the [Google Maps API](https://developers.google.com/maps/documentation/android/) which is included with the Google APIs.

My Bus Edinburgh is not written in Eclipse with the [Android Developer Tools (ADT)](http://developer.android.com/sdk/eclipse-adt.html), it is actually written in [Netbeans](http://netbeans.org/) with the [NBAndroid](http://www.nbandroid.org/) plugin. To get My Bus Edinburgh compiled you do not actually need an IDE, simply the command line. The project will open up in any suitable IDE which will recognise it. This includes Eclipse (with ADT plugin) and Netbeans (with NBAndroid plugin).

Important: make sure the Android SDK tools are in your PATH.

# Obtaining the source #

Now the prerequisites have been installed, the source can be downloaded. The project is hosted here on Google Code and the repository is SVN. You must have the SVN tools installed to download the source tree.

The URL for the repository is: http://androidedinburghbustracker.googlecode.com/svn/tags/2.1/EdinburghBusTrackerAndroid/ (This was the original name for the project before it became My Bus Edinburgh.)

This URL can be fed in to your SVN GUI tool, or SVN command line. First of all, you should create a directory where the source code will be downloaded to (applicable to Mac OS X and Linux, adjust for Windows);

```
mkdir MyBusEdinburgh
cd MyBusEdinburgh
```

Now the source can be downloaded;

```
svn checkout http://androidedinburghbustracker.googlecode.com/svn/tags/2.1/EdinburghBusTrackerAndroid/
```

The source should now be downloaded.

# Preparing the project for compilation #

The project cannot yet be compiled. The next few steps will get the project ready for compilation.

Change to the project directory;

```
cd EdinburghBusTrackerAndroid
```

Now the Android update project command needs to be run to make sure the build.xml file and properties files are up to date, and create them if they are missing. This can be run by executing;

```
android update project -p .
```

To communicate with the My Bus Tracker web services, all access require an API key to be provided. This is stored in local.properties in the project. To obtain a key, you must contact The City of Edinburgh Council for your own one. The My Bus Edinburgh key is not and will not be made public. Also, people should not simply take this application and use it in Edinburgh, the source code is provided for educational and transparency reasons.

The project also uses [BugSense](http://www.bugsense.com/) to report back anonymous exception and crash reports. You can disable this if you wish by commenting out all references to BugSense in MainActivity.java. If you wish to keep this, you will need to sign up with BugSense and obtain your own API key. The My Bus Edinburgh key is not provided so that other developers do not pollute the My Bus Edinburgh exception reporting.

Open up the local.properties file and add the two following lines at the end of the file;

```
api.key=<your API key, denoted as a comma-separated list of ASCII characters in integer form>
bugsense.key=<your BugSense API key, in plain-text format. If you have disabled BugSense, you must still provide this variable, but just supply an empty string>
```

For example;

```
api.key=65, 72, 84, 66
bugsense.key=abc123
```

# Compiling #

If the project is open in an IDE, your IDE may report that there are still errors in the code and you will not be able to compile. This is because two source files are missing: R.java and ApiKey.java.

R.java is generated by the Android SDK tools are compile time, and ApiKey.java is generated by build.xml at compile time by taking the variables you have provided in local.properties, as described above.

You can either clean and build the project in your IDE, or do this on the command line. To do this on the command line, execute the following;

```
ant clean debug
```

This produces an Android Package (APK) file which is signed with your local debug certificate. At this point, you should be able to build the app successfully. If not, revisit the steps above to ensure they were carried out correctly, or [file a ticket](http://code.google.com/p/androidedinburghbustracker/issues/list).

The resulting APK file lives at bin/MyBusEdinburgh-debug.apk

# Running on a device or emulator #

The device or emulator must be Android 1.6 or above, and have the Google APIs.

Also, ensure that debugging mode is enabled and "Allow unknown sources" is enabled.

## From an IDE ##

Simply run the application and choose the device you wish to deploy to.

## From command line ##

Firstly, you need to the serial number of the device you wish to deploy to, this can be obtained from running;

```
adb devices
```

Copy the serial number for the device, and execute;

```
adb -s <serial number> install -r bin/MyBusEdinburgh-debug.apk
```